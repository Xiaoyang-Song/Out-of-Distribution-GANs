
[KeOps] Warning : There were warnings or errors compiling formula :
<stdin>:1:10: fatal error: cuda.h: No such file or directory
compilation terminated.

[KeOps] Warning : 
    The location of Cuda header files cuda.h and nvrtc.h could not be detected on your system.
    You must determine their location and then define the environment variable CUDA_PATH,
    either before launching Python or using os.environ before importing keops. For example
    if these files are in /vol/cuda/10.2.89-cudnn7.6.4.38/include you can do :
      import os
      os.environ['CUDA_PATH'] = '/vol/cuda/10.2.89-cudnn7.6.4.38'
    
[KeOps] Compiling cuda jit compiler engine ... 
[KeOps] Warning : There were warnings or errors compiling formula :
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/nvrtc_jit.cpp:5:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
[pyKeOps] Compiling nvrtc binder for python ... 
[KeOps] Warning : There were warnings or errors compiling formula :
In file included from /home/xysong/.local/lib/python3.9/site-packages/pykeops/common/keops_io/pykeops_nvrtc.cpp:4:
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/keops_nvrtc.cpp:6:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
[pyKeOps] Compiling nvrtc binder for python ... 
[KeOps] Warning : There were warnings or errors compiling formula :
In file included from /home/xysong/.local/lib/python3.9/site-packages/pykeops/common/keops_io/pykeops_nvrtc.cpp:4:
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/keops_nvrtc.cpp:6:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
[pyKeOps] Compiling nvrtc binder for python ... 
[KeOps] Warning : There were warnings or errors compiling formula :
In file included from /home/xysong/.local/lib/python3.9/site-packages/pykeops/common/keops_io/pykeops_nvrtc.cpp:4:
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/keops_nvrtc.cpp:6:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
Experiment: FashionMNIST
Experiment regime: Balanced
Method: OOD-GAN
================================================================================
Number of observed OoD samples (class-level): 64
Input Dimension: 28 x 28 x 1
Number of InD classes: 8
Number of Epochs: 16.
Hyperparameters: lambda_ce=1 & lambda_w=1 & scaling=0.001 & d_lr=0.001 & g_lr=0.001 & B_InD: 64 & B_OoD: 32 & n_d: 1 & n_g: 1
Score Function: Wasserstein
Finished Processing Input Arguments.
-- Current Device: Tesla V100-PCIE-16GB
-- Device Total Memory: 15.77 GB
-- Let's use 1 GPUs!
Verifying OOD set labels: tensor([8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
        8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
        8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9,
        9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
        9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
        9, 9, 9, 9, 9, 9, 9, 9])
Verifying OOD class distribution: Counter({8: 64, 9: 64})
Monte Carlo Iteration 0
DenseNet
Deep_G
OoD sample shape: torch.Size([128, 1, 28, 28])
Step: 0    | D:  1.2994 | CE:  2.1043 | S_OoD:  0.8057 | S_z:  0.8016 | G: -0.0008 | S_z:  0.8317 | dist: 0.0906
Step: 20   | D:  0.4447 | CE:  1.2315 | S_OoD:  0.7877 | S_z:  0.8322 | G: -0.0008 | S_z:  0.8343 | dist: 0.0843
Step: 40   | D:  0.1804 | CE:  0.9427 | S_OoD:  0.7632 | S_z:  0.8037 | G: -0.0008 | S_z:  0.8140 | dist: 0.0994
Step: 60   | D: -0.1179 | CE:  0.6820 | S_OoD:  0.8007 | S_z:  0.7997 | G: -0.0008 | S_z:  0.8014 | dist: 0.1018
Step: 80   | D: -0.1824 | CE:  0.6335 | S_OoD:  0.8167 | S_z:  0.7833 | G: -0.0008 | S_z:  0.7799 | dist: 0.0592
Step: 100  | D: -0.0339 | CE:  0.7845 | S_OoD:  0.8192 | S_z:  0.7692 | G: -0.0008 | S_z:  0.7722 | dist: 0.0763
Step: 120  | D: -0.0645 | CE:  0.7559 | S_OoD:  0.8211 | S_z:  0.7785 | G: -0.0008 | S_z:  0.7823 | dist: 0.0771
Step: 140  | D: -0.2769 | CE:  0.5585 | S_OoD:  0.8362 | S_z:  0.7543 | G: -0.0008 | S_z:  0.7564 | dist: 0.0891
Step: 160  | D: -0.3347 | CE:  0.4945 | S_OoD:  0.8300 | S_z:  0.7418 | G: -0.0007 | S_z:  0.7453 | dist: 0.0852
Step: 180  | D: -0.4184 | CE:  0.4187 | S_OoD:  0.8378 | S_z:  0.7528 | G: -0.0008 | S_z:  0.7535 | dist: 0.0997
Step: 200  | D: -0.4948 | CE:  0.3451 | S_OoD:  0.8406 | S_z:  0.7332 | G: -0.0007 | S_z:  0.7332 | dist: 0.1130
Step: 220  | D: -0.5088 | CE:  0.3383 | S_OoD:  0.8478 | S_z:  0.7304 | G: -0.0007 | S_z:  0.7263 | dist: 0.1073
Step: 240  | D: -0.2757 | CE:  0.5619 | S_OoD:  0.8383 | S_z:  0.7483 | G: -0.0008 | S_z:  0.7509 | dist: 0.0949
Step: 260  | D: -0.3873 | CE:  0.4601 | S_OoD:  0.8482 | S_z:  0.7419 | G: -0.0007 | S_z:  0.7397 | dist: 0.0827
Step: 280  | D: -0.3102 | CE:  0.5393 | S_OoD:  0.8502 | S_z:  0.7096 | G: -0.0007 | S_z:  0.7215 | dist: 0.0736
Step: 300  | D: -0.3731 | CE:  0.4733 | S_OoD:  0.8471 | S_z:  0.7021 | G: -0.0007 | S_z:  0.6978 | dist: 0.0953
Step: 320  | D: -0.3603 | CE:  0.4741 | S_OoD:  0.8351 | S_z:  0.7205 | G: -0.0007 | S_z:  0.7127 | dist: 0.0870
Step: 340  | D: -0.3315 | CE:  0.5124 | S_OoD:  0.8445 | S_z:  0.7241 | G: -0.0007 | S_z:  0.7179 | dist: 0.0945
Step: 360  | D: -0.5321 | CE:  0.3035 | S_OoD:  0.8363 | S_z:  0.7105 | G: -0.0007 | S_z:  0.7127 | dist: 0.0723
Step: 380  | D: -0.3694 | CE:  0.4823 | S_OoD:  0.8524 | S_z:  0.7006 | G: -0.0007 | S_z:  0.6932 | dist: 0.1227
Step: 400  | D: -0.3987 | CE:  0.4576 | S_OoD:  0.8570 | S_z:  0.7171 | G: -0.0007 | S_z:  0.7199 | dist: 0.0969
Step: 420  | D: -0.5181 | CE:  0.3341 | S_OoD:  0.8528 | S_z:  0.6768 | G: -0.0007 | S_z:  0.6798 | dist: 0.0895
Step: 440  | D: -0.3832 | CE:  0.4634 | S_OoD:  0.8473 | S_z:  0.7186 | G: -0.0007 | S_z:  0.7100 | dist: 0.0694
Step: 460  | D: -0.4756 | CE:  0.3732 | S_OoD:  0.8495 | S_z:  0.6890 | G: -0.0007 | S_z:  0.6914 | dist: 0.0863
Step: 480  | D: -0.5405 | CE:  0.3135 | S_OoD:  0.8547 | S_z:  0.7033 | G: -0.0007 | S_z:  0.7028 | dist: 0.0969
Step: 500  | D: -0.4220 | CE:  0.4336 | S_OoD:  0.8563 | S_z:  0.7003 | G: -0.0007 | S_z:  0.7012 | dist: 0.0722
Step: 520  | D: -0.5450 | CE:  0.3100 | S_OoD:  0.8556 | S_z:  0.6838 | G: -0.0007 | S_z:  0.6815 | dist: 0.0931
Step: 540  | D: -0.5292 | CE:  0.3284 | S_OoD:  0.8583 | S_z:  0.6770 | G: -0.0007 | S_z:  0.6810 | dist: 0.0850
Step: 560  | D: -0.4749 | CE:  0.3783 | S_OoD:  0.8538 | S_z:  0.6761 | G: -0.0007 | S_z:  0.6741 | dist: 0.0886
Step: 580  | D: -0.6137 | CE:  0.2460 | S_OoD:  0.8605 | S_z:  0.7205 | G: -0.0007 | S_z:  0.7092 | dist: 0.0975
Step: 600  | D: -0.5682 | CE:  0.2805 | S_OoD:  0.8493 | S_z:  0.7066 | G: -0.0007 | S_z:  0.7033 | dist: 0.0673
Step: 620  | D: -0.4570 | CE:  0.4006 | S_OoD:  0.8583 | S_z:  0.7045 | G: -0.0007 | S_z:  0.7100 | dist: 0.0936
Step: 640  | D: -0.4315 | CE:  0.4229 | S_OoD:  0.8550 | S_z:  0.6203 | G: -0.0006 | S_z:  0.6205 | dist: 0.1096
Step: 660  | D: -0.6726 | CE:  0.1837 | S_OoD:  0.8569 | S_z:  0.6434 | G: -0.0006 | S_z:  0.6461 | dist: 0.0686
Step: 680  | D: -0.3999 | CE:  0.4460 | S_OoD:  0.8465 | S_z:  0.6582 | G: -0.0007 | S_z:  0.6539 | dist: 0.0823
Step: 700  | D: -0.1805 | CE:  0.6731 | S_OoD:  0.8543 | S_z:  0.6862 | G: -0.0007 | S_z:  0.6871 | dist: 0.0772
Step: 720  | D: -0.5925 | CE:  0.2633 | S_OoD:  0.8564 | S_z:  0.6326 | G: -0.0006 | S_z:  0.6261 | dist: 0.0827
Step: 740  | D: -0.4389 | CE:  0.4142 | S_OoD:  0.8538 | S_z:  0.6433 | G: -0.0006 | S_z:  0.6424 | dist: 0.0949
Computing evaluation statistics...
> Evaluating InD Wasserstein distances...
> Evaluating OoD Wasserstein distances...

Overall Statistics
TPR@95TNR: 1.0
mean: 1.0 | std: 0.0 | MAD: 0.0
TPR@95TNR-Threshold: 0.5087488412857053
mean: 0.50875 | std: 0.0 | MAD: 0.0
TPR@99TNR: 1.0
mean: 1.0 | std: 0.0 | MAD: 0.0
TPR@99TNR-Threshold
: 0.6268216067552568
mean: 0.62682 | std: 0.0 | MAD: 0.0
AUROC: 0.9999996875

Validation Accuracy: 0.874
Validation Classification Loss: 0.34494505524635316
Step: 10   | D: -0.6031 | CE:  0.2556 | S_OoD:  0.8594 | S_z:  0.6634 | G: -0.0007 | S_z:  0.6650 | dist: 0.1035
Step: 30   | D: -0.6645 | CE:  0.1858 | S_OoD:  0.8510 | S_z:  0.6536 | G: -0.0006 | S_z:  0.6458 | dist: 0.1042
Step: 50   | D: -0.6140 | CE:  0.2437 | S_OoD:  0.8583 | S_z:  0.6555 | G: -0.0007 | S_z:  0.6564 | dist: 0.0839
Step: 70   | D: -0.6143 | CE:  0.2340 | S_OoD:  0.8490 | S_z:  0.6446 | G: -0.0006 | S_z:  0.6398 | dist: 0.0859
Step: 90   | D: -0.5656 | CE:  0.2885 | S_OoD:  0.8547 | S_z:  0.6273 | G: -0.0006 | S_z:  0.6387 | dist: 0.1002
Step: 110  | D: -0.5915 | CE:  0.2595 | S_OoD:  0.8516 | S_z:  0.6533 | G: -0.0007 | S_z:  0.6505 | dist: 0.0725
Step: 130  | D: -0.5016 | CE:  0.3552 | S_OoD:  0.8574 | S_z:  0.6315 | G: -0.0006 | S_z:  0.6309 | dist: 0.1029
Step: 150  | D: -0.5804 | CE:  0.2783 | S_OoD:  0.8594 | S_z:  0.6448 | G: -0.0006 | S_z:  0.6445 | dist: 0.0965
Step: 170  | D: -0.5361 | CE:  0.3210 | S_OoD:  0.8577 | S_z:  0.6087 | G: -0.0006 | S_z:  0.6029 | dist: 0.1104
Step: 190  | D: -0.6105 | CE:  0.2506 | S_OoD:  0.8617 | S_z:  0.6554 | G: -0.0006 | S_z:  0.6466 | dist: 0.1066
Step: 210  | D: -0.5692 | CE:  0.2901 | S_OoD:  0.8599 | S_z:  0.6489 | G: -0.0006 | S_z:  0.6440 | dist: 0.0739
Step: 230  | D: -0.5359 | CE:  0.3172 | S_OoD:  0.8538 | S_z:  0.6516 | G: -0.0007 | S_z:  0.6541 | dist: 0.1004
Step: 250  | D: -0.6537 | CE:  0.2024 | S_OoD:  0.8568 | S_z:  0.6610 | G: -0.0007 | S_z:  0.6611 | dist: 0.1035
Step: 270  | D: -0.6557 | CE:  0.2000 | S_OoD:  0.8563 | S_z:  0.6331 | G: -0.0006 | S_z:  0.6277 | dist: 0.0853
Step: 290  | D: -0.3686 | CE:  0.4862 | S_OoD:  0.8554 | S_z:  0.6305 | G: -0.0006 | S_z:  0.6336 | dist: 0.0967
Step: 310  | D: -0.4883 | CE:  0.3133 | S_OoD:  0.8021 | S_z:  0.6196 | G: -0.0006 | S_z:  0.6240 | dist: 0.0908
Step: 330  | D: -0.5835 | CE:  0.2657 | S_OoD:  0.8498 | S_z:  0.6385 | G: -0.0006 | S_z:  0.6411 | dist: 0.0500
Step: 350  | D: -0.5801 | CE:  0.2771 | S_OoD:  0.8579 | S_z:  0.5934 | G: -0.0006 | S_z:  0.5992 | dist: 0.0971
Step: 370  | D: -0.5744 | CE:  0.2846 | S_OoD:  0.8596 | S_z:  0.6208 | G: -0.0006 | S_z:  0.6180 | dist: 0.0810
Step: 390  | D: -0.6179 | CE:  0.2418 | S_OoD:  0.8604 | S_z:  0.6398 | G: -0.0006 | S_z:  0.6274 | dist: 0.0898
Step: 410  | D: -0.5525 | CE:  0.2988 | S_OoD:  0.8519 | S_z:  0.6258 | G: -0.0006 | S_z:  0.6345 | dist: 0.0903
Step: 430  | D: -0.5854 | CE:  0.2659 | S_OoD:  0.8519 | S_z:  0.6035 | G: -0.0006 | S_z:  0.5984 | dist: 0.0713
Step: 450  | D: -0.5260 | CE:  0.3333 | S_OoD:  0.8599 | S_z:  0.6218 | G: -0.0006 | S_z:  0.6158 | dist: 0.0844
Step: 470  | D: -0.7249 | CE:  0.1297 | S_OoD:  0.8553 | S_z:  0.6327 | G: -0.0006 | S_z:  0.6319 | dist: 0.0795
Step: 490  | D: -0.4818 | CE:  0.3798 | S_OoD:  0.8622 | S_z:  0.6031 | G: -0.0006 | S_z:  0.5989 | dist: 0.0648
Step: 510  | D: -0.4390 | CE:  0.4149 | S_OoD:  0.8545 | S_z:  0.6395 | G: -0.0006 | S_z:  0.6459 | dist: 0.0870
Step: 530  | D: -0.5563 | CE:  0.2976 | S_OoD:  0.8545 | S_z:  0.6365 | G: -0.0006 | S_z:  0.6377 | dist: 0.0886
Step: 550  | D: -0.6053 | CE:  0.2466 | S_OoD:  0.8525 | S_z:  0.6340 | G: -0.0006 | S_z:  0.6470 | dist: 0.1026
Step: 570  | D: -0.6536 | CE:  0.2059 | S_OoD:  0.8601 | S_z:  0.6097 | G: -0.0006 | S_z:  0.6128 | dist: 0.1117
Step: 590  | D: -0.5863 | CE:  0.2757 | S_OoD:  0.8627 | S_z:  0.6201 | G: -0.0006 | S_z:  0.6188 | dist: 0.0614
Step: 610  | D: -0.7478 | CE:  0.1169 | S_OoD:  0.8653 | S_z:  0.6090 | G: -0.0006 | S_z:  0.6060 | dist: 0.0772
Step: 630  | D: -0.5920 | CE:  0.2613 | S_OoD:  0.8539 | S_z:  0.6249 | G: -0.0006 | S_z:  0.6206 | dist: 0.0990
Step: 650  | D: -0.7043 | CE:  0.1509 | S_OoD:  0.8558 | S_z:  0.6207 | G: -0.0006 | S_z:  0.6133 | dist: 0.0624
Step: 670  | D: -0.5141 | CE:  0.3422 | S_OoD:  0.8569 | S_z:  0.6283 | G: -0.0006 | S_z:  0.6288 | dist: 0.0771
Step: 690  | D: -0.6688 | CE:  0.1853 | S_OoD:  0.8548 | S_z:  0.6324 | G: -0.0006 | S_z:  0.6324 | dist: 0.0719
Step: 710  | D: -0.5433 | CE:  0.3086 | S_OoD:  0.8525 | S_z:  0.5833 | G: -0.0006 | S_z:  0.5793 | dist: 0.0556
Step: 730  | D: -0.6767 | CE:  0.1816 | S_OoD:  0.8588 | S_z:  0.5913 | G: -0.0006 | S_z:  0.5810 | dist: 0.0710
Computing evaluation statistics...
> Evaluating InD Wasserstein distances...
> Evaluating OoD Wasserstein distances...

Overall Statistics
TPR@95TNR: 1.0
mean: 1.0 | std: 0.0 | MAD: 0.0
TPR@95TNR-Threshold: 0.4710879415273663
mean: 0.47109 | std: 0.0 | MAD: 0.0
TPR@99TNR: 0.9995
mean: 0.9995 | std: 0.0 | MAD: 0.0
TPR@99TNR-Threshold
: 0.587059977054596
mean: 0.58706 | std: 0.0 | MAD: 0.0
AUROC: 0.9999864375

Validation Accuracy: 0.90075
Validation Classification Loss: 0.2753951993584633
