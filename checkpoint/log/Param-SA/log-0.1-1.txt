
[KeOps] Warning : There were warnings or errors compiling formula :
<stdin>:1:10: fatal error: cuda.h: No such file or directory
compilation terminated.

[KeOps] Warning : 
    The location of Cuda header files cuda.h and nvrtc.h could not be detected on your system.
    You must determine their location and then define the environment variable CUDA_PATH,
    either before launching Python or using os.environ before importing keops. For example
    if these files are in /vol/cuda/10.2.89-cudnn7.6.4.38/include you can do :
      import os
      os.environ['CUDA_PATH'] = '/vol/cuda/10.2.89-cudnn7.6.4.38'
    
[KeOps] Compiling cuda jit compiler engine ... 
[KeOps] Warning : There were warnings or errors compiling formula :
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/nvrtc_jit.cpp:5:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
[pyKeOps] Compiling nvrtc binder for python ... 
[KeOps] Warning : There were warnings or errors compiling formula :
In file included from /home/xysong/.local/lib/python3.9/site-packages/pykeops/common/keops_io/pykeops_nvrtc.cpp:4:
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/keops_nvrtc.cpp:6:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
[pyKeOps] Compiling nvrtc binder for python ... 
[KeOps] Warning : There were warnings or errors compiling formula :
In file included from /home/xysong/.local/lib/python3.9/site-packages/pykeops/common/keops_io/pykeops_nvrtc.cpp:4:
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/keops_nvrtc.cpp:6:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
[pyKeOps] Compiling nvrtc binder for python ... 
[KeOps] Warning : There were warnings or errors compiling formula :
In file included from /home/xysong/.local/lib/python3.9/site-packages/pykeops/common/keops_io/pykeops_nvrtc.cpp:4:
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/keops_nvrtc.cpp:6:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
Experiment: FashionMNIST
Experiment regime: Balanced
Method: OOD-GAN
================================================================================
Number of observed OoD samples (class-level): 64
Input Dimension: 28 x 28 x 1
Number of InD classes: 8
Number of Epochs: 16.
Hyperparameters: lambda_ce=1 & lambda_w=0.1 & scaling=10.0 & d_lr=0.001 & g_lr=0.001 & B_InD: 64 & B_OoD: 32 & n_d: 1 & n_g: 1
Score Function: Wasserstein
Finished Processing Input Arguments.
-- Current Device: Tesla V100-PCIE-16GB
-- Device Total Memory: 15.77 GB
-- Let's use 1 GPUs!
Verifying OOD set labels: tensor([8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
        8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
        8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9,
        9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
        9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
        9, 9, 9, 9, 9, 9, 9, 9])
Verifying OOD class distribution: Counter({8: 64, 9: 64})
Monte Carlo Iteration 0
DenseNet
Deep_G
OoD sample shape: torch.Size([128, 1, 28, 28])
Step: 0    | D:  2.8253 | CE:  2.1043 | S_OoD:  0.8057 | S_z:  0.8016 | G: -0.7706 | S_z:  0.7706 | dist: 0.0906
Step: 20   | D:  1.6046 | CE:  1.2524 | S_OoD:  0.4996 | S_z:  0.4022 | G: -0.3488 | S_z:  0.3488 | dist: 0.0843
Step: 40   | D:  1.1431 | CE:  1.0204 | S_OoD:  0.4431 | S_z:  0.1669 | G: -0.1443 | S_z:  0.1443 | dist: 0.0994
Step: 60   | D:  0.7477 | CE:  0.7115 | S_OoD:  0.4079 | S_z:  0.0770 | G: -0.0805 | S_z:  0.0805 | dist: 0.1018
Step: 80   | D:  0.8171 | CE:  0.8021 | S_OoD:  0.3940 | S_z:  0.0544 | G: -0.0495 | S_z:  0.0495 | dist: 0.0592
Step: 100  | D:  0.7687 | CE:  0.7766 | S_OoD:  0.4615 | S_z:  0.0382 | G: -0.0372 | S_z:  0.0372 | dist: 0.0763
Step: 120  | D:  0.8506 | CE:  0.8619 | S_OoD:  0.4738 | S_z:  0.0361 | G: -0.0360 | S_z:  0.0360 | dist: 0.0771
Step: 140  | D:  0.5953 | CE:  0.6173 | S_OoD:  0.4776 | S_z:  0.0258 | G: -0.0235 | S_z:  0.0235 | dist: 0.0891
Step: 160  | D:  0.4748 | CE:  0.4993 | S_OoD:  0.4475 | S_z:  0.0202 | G: -0.0212 | S_z:  0.0212 | dist: 0.0852
Step: 180  | D:  0.4392 | CE:  0.4700 | S_OoD:  0.4898 | S_z:  0.0182 | G: -0.0159 | S_z:  0.0159 | dist: 0.0997
Step: 200  | D:  0.3704 | CE:  0.4014 | S_OoD:  0.4556 | S_z:  0.0145 | G: -0.0141 | S_z:  0.0141 | dist: 0.1130
Step: 220  | D:  0.3419 | CE:  0.3741 | S_OoD:  0.4727 | S_z:  0.0151 | G: -0.0153 | S_z:  0.0153 | dist: 0.1073
Step: 240  | D:  0.5256 | CE:  0.5625 | S_OoD:  0.4923 | S_z:  0.0123 | G: -0.0140 | S_z:  0.0140 | dist: 0.0949
Step: 260  | D:  0.3942 | CE:  0.4356 | S_OoD:  0.5252 | S_z:  0.0111 | G: -0.0113 | S_z:  0.0113 | dist: 0.0827
Step: 280  | D:  0.5154 | CE:  0.5551 | S_OoD:  0.4955 | S_z:  0.0098 | G: -0.0092 | S_z:  0.0092 | dist: 0.0736
Step: 300  | D:  0.4202 | CE:  0.4602 | S_OoD:  0.4974 | S_z:  0.0097 | G: -0.0095 | S_z:  0.0095 | dist: 0.0953
Step: 320  | D:  0.4352 | CE:  0.4754 | S_OoD:  0.4877 | S_z:  0.0086 | G: -0.0085 | S_z:  0.0085 | dist: 0.0870
Step: 340  | D:  0.5122 | CE:  0.5569 | S_OoD:  0.5290 | S_z:  0.0082 | G: -0.0089 | S_z:  0.0089 | dist: 0.0945
Step: 360  | D:  0.2848 | CE:  0.3331 | S_OoD:  0.5623 | S_z:  0.0080 | G: -0.0077 | S_z:  0.0077 | dist: 0.0723
Step: 380  | D:  0.4554 | CE:  0.5007 | S_OoD:  0.5173 | S_z:  0.0064 | G: -0.0065 | S_z:  0.0065 | dist: 0.1227
Step: 400  | D:  0.4554 | CE:  0.5057 | S_OoD:  0.5683 | S_z:  0.0066 | G: -0.0066 | S_z:  0.0066 | dist: 0.0969
Step: 420  | D:  0.3022 | CE:  0.3491 | S_OoD:  0.5271 | S_z:  0.0058 | G: -0.0060 | S_z:  0.0060 | dist: 0.0895
Step: 440  | D:  0.4521 | CE:  0.4976 | S_OoD:  0.5166 | S_z:  0.0061 | G: -0.0070 | S_z:  0.0070 | dist: 0.0694
Step: 460  | D:  0.4068 | CE:  0.4493 | S_OoD:  0.4828 | S_z:  0.0058 | G: -0.0058 | S_z:  0.0058 | dist: 0.0863
Step: 480  | D:  0.2683 | CE:  0.3151 | S_OoD:  0.5091 | S_z:  0.0041 | G: -0.0045 | S_z:  0.0045 | dist: 0.0969
Step: 500  | D:  0.4197 | CE:  0.4704 | S_OoD:  0.5541 | S_z:  0.0047 | G: -0.0046 | S_z:  0.0046 | dist: 0.0722
Step: 520  | D:  0.3218 | CE:  0.3758 | S_OoD:  0.5840 | S_z:  0.0045 | G: -0.0047 | S_z:  0.0047 | dist: 0.0931
Step: 540  | D:  0.2753 | CE:  0.3288 | S_OoD:  0.5757 | S_z:  0.0041 | G: -0.0036 | S_z:  0.0036 | dist: 0.0850
Step: 560  | D:  0.3582 | CE:  0.3994 | S_OoD:  0.4489 | S_z:  0.0037 | G: -0.0034 | S_z:  0.0034 | dist: 0.0886
Step: 580  | D:  0.2508 | CE:  0.3051 | S_OoD:  0.5946 | S_z:  0.0052 | G: -0.0051 | S_z:  0.0051 | dist: 0.0975
Step: 600  | D:  0.2543 | CE:  0.3065 | S_OoD:  0.5663 | S_z:  0.0044 | G: -0.0042 | S_z:  0.0042 | dist: 0.0673
Step: 620  | D:  0.3764 | CE:  0.4309 | S_OoD:  0.5775 | S_z:  0.0032 | G: -0.0031 | S_z:  0.0031 | dist: 0.0936
Step: 640  | D:  0.4194 | CE:  0.4697 | S_OoD:  0.5424 | S_z:  0.0040 | G: -0.0036 | S_z:  0.0036 | dist: 0.1096
Step: 660  | D:  0.1700 | CE:  0.2240 | S_OoD:  0.5682 | S_z:  0.0028 | G: -0.0029 | S_z:  0.0029 | dist: 0.0686
Step: 680  | D:  0.3319 | CE:  0.3878 | S_OoD:  0.5834 | S_z:  0.0024 | G: -0.0022 | S_z:  0.0022 | dist: 0.0823
Step: 700  | D:  0.6115 | CE:  0.6685 | S_OoD:  0.5983 | S_z:  0.0028 | G: -0.0029 | S_z:  0.0029 | dist: 0.0772
Step: 720  | D:  0.2209 | CE:  0.2768 | S_OoD:  0.5869 | S_z:  0.0027 | G: -0.0031 | S_z:  0.0031 | dist: 0.0827
Step: 740  | D:  0.3518 | CE:  0.4088 | S_OoD:  0.6011 | S_z:  0.0031 | G: -0.0030 | S_z:  0.0030 | dist: 0.0949
Computing evaluation statistics...
> Evaluating InD Wasserstein distances...
> Evaluating OoD Wasserstein distances...

Overall Statistics
TPR@95TNR: 0.6305000000000001
mean: 0.6305 | std: 0.0 | MAD: 0.0
TPR@95TNR-Threshold: 0.4983333677053448
mean: 0.49833 | std: 0.0 | MAD: 0.0
TPR@99TNR: 0.34099999999999997
mean: 0.341 | std: 0.0 | MAD: 0.0
TPR@99TNR-Threshold
: 0.6109058088064195
mean: 0.61091 | std: 0.0 | MAD: 0.0
AUROC: 0.928795625

Validation Accuracy: 0.877
Validation Classification Loss: 0.3416040596961975
Step: 10   | D:  0.1928 | CE:  0.2514 | S_OoD:  0.6158 | S_z:  0.0029 | G: -0.0029 | S_z:  0.0029 | dist: 0.1035
Step: 30   | D:  0.1342 | CE:  0.1891 | S_OoD:  0.5822 | S_z:  0.0033 | G: -0.0031 | S_z:  0.0031 | dist: 0.1042
Step: 50   | D:  0.1989 | CE:  0.2546 | S_OoD:  0.5870 | S_z:  0.0030 | G: -0.0030 | S_z:  0.0030 | dist: 0.0839
Step: 70   | D:  0.2510 | CE:  0.3082 | S_OoD:  0.6013 | S_z:  0.0029 | G: -0.0027 | S_z:  0.0027 | dist: 0.0859
Step: 90   | D:  0.2162 | CE:  0.2745 | S_OoD:  0.6075 | S_z:  0.0024 | G: -0.0022 | S_z:  0.0022 | dist: 0.1002
Step: 110  | D:  0.2038 | CE:  0.2599 | S_OoD:  0.5826 | S_z:  0.0021 | G: -0.0022 | S_z:  0.0022 | dist: 0.0725
Step: 130  | D:  0.3019 | CE:  0.3591 | S_OoD:  0.5962 | S_z:  0.0024 | G: -0.0025 | S_z:  0.0025 | dist: 0.1029
Step: 150  | D:  0.2391 | CE:  0.2942 | S_OoD:  0.5721 | S_z:  0.0021 | G: -0.0024 | S_z:  0.0024 | dist: 0.0965
Step: 170  | D:  0.3528 | CE:  0.4103 | S_OoD:  0.5943 | S_z:  0.0019 | G: -0.0018 | S_z:  0.0018 | dist: 0.1104
Step: 190  | D:  0.2274 | CE:  0.2863 | S_OoD:  0.6147 | S_z:  0.0026 | G: -0.0025 | S_z:  0.0025 | dist: 0.1066
Step: 210  | D:  0.2415 | CE:  0.3017 | S_OoD:  0.6171 | S_z:  0.0015 | G: -0.0016 | S_z:  0.0016 | dist: 0.0739
Step: 230  | D:  0.2677 | CE:  0.3223 | S_OoD:  0.5627 | S_z:  0.0017 | G: -0.0016 | S_z:  0.0016 | dist: 0.1004
Step: 250  | D:  0.1160 | CE:  0.1722 | S_OoD:  0.5783 | S_z:  0.0016 | G: -0.0015 | S_z:  0.0015 | dist: 0.1035
Step: 270  | D:  0.1864 | CE:  0.2416 | S_OoD:  0.5650 | S_z:  0.0013 | G: -0.0013 | S_z:  0.0013 | dist: 0.0853
Step: 290  | D:  0.3978 | CE:  0.4616 | S_OoD:  0.6571 | S_z:  0.0019 | G: -0.0021 | S_z:  0.0021 | dist: 0.0967
Step: 310  | D:  0.2385 | CE:  0.2997 | S_OoD:  0.6373 | S_z:  0.0025 | G: -0.0026 | S_z:  0.0026 | dist: 0.0908
Step: 330  | D:  0.2069 | CE:  0.2670 | S_OoD:  0.6242 | S_z:  0.0023 | G: -0.0023 | S_z:  0.0023 | dist: 0.0500
Step: 350  | D:  0.2617 | CE:  0.3222 | S_OoD:  0.6251 | S_z:  0.0020 | G: -0.0021 | S_z:  0.0021 | dist: 0.0971
Step: 370  | D:  0.2428 | CE:  0.3023 | S_OoD:  0.6116 | S_z:  0.0016 | G: -0.0017 | S_z:  0.0017 | dist: 0.0810
Step: 390  | D:  0.2486 | CE:  0.3085 | S_OoD:  0.6149 | S_z:  0.0016 | G: -0.0017 | S_z:  0.0017 | dist: 0.0898
Step: 410  | D:  0.2790 | CE:  0.3335 | S_OoD:  0.5704 | S_z:  0.0026 | G: -0.0024 | S_z:  0.0024 | dist: 0.0903
Step: 430  | D:  0.1813 | CE:  0.2447 | S_OoD:  0.6495 | S_z:  0.0016 | G: -0.0015 | S_z:  0.0015 | dist: 0.0713
Step: 450  | D:  0.2984 | CE:  0.3560 | S_OoD:  0.5908 | S_z:  0.0015 | G: -0.0016 | S_z:  0.0016 | dist: 0.0844
Step: 470  | D:  0.0969 | CE:  0.1555 | S_OoD:  0.6057 | S_z:  0.0020 | G: -0.0021 | S_z:  0.0021 | dist: 0.0795
Step: 490  | D:  0.3446 | CE:  0.4028 | S_OoD:  0.6031 | S_z:  0.0021 | G: -0.0022 | S_z:  0.0022 | dist: 0.0648
Step: 510  | D:  0.3124 | CE:  0.3718 | S_OoD:  0.6128 | S_z:  0.0019 | G: -0.0018 | S_z:  0.0018 | dist: 0.0870
Step: 530  | D:  0.1993 | CE:  0.2584 | S_OoD:  0.6067 | S_z:  0.0016 | G: -0.0014 | S_z:  0.0014 | dist: 0.0886
Step: 550  | D:  0.2403 | CE:  0.3020 | S_OoD:  0.6316 | S_z:  0.0015 | G: -0.0014 | S_z:  0.0014 | dist: 0.1026
Step: 570  | D:  0.1361 | CE:  0.2010 | S_OoD:  0.6665 | S_z:  0.0018 | G: -0.0018 | S_z:  0.0018 | dist: 0.1117
Step: 590  | D:  0.2021 | CE:  0.2666 | S_OoD:  0.6567 | S_z:  0.0012 | G: -0.0012 | S_z:  0.0012 | dist: 0.0614
Step: 610  | D:  0.0483 | CE:  0.1135 | S_OoD:  0.6678 | S_z:  0.0015 | G: -0.0015 | S_z:  0.0015 | dist: 0.0772
Step: 630  | D:  0.2004 | CE:  0.2643 | S_OoD:  0.6492 | S_z:  0.0010 | G: -0.0012 | S_z:  0.0012 | dist: 0.0990
Step: 650  | D:  0.1036 | CE:  0.1651 | S_OoD:  0.6273 | S_z:  0.0013 | G: -0.0013 | S_z:  0.0013 | dist: 0.0624
Step: 670  | D:  0.3028 | CE:  0.3668 | S_OoD:  0.6522 | S_z:  0.0012 | G: -0.0010 | S_z:  0.0010 | dist: 0.0771
Step: 690  | D:  0.1755 | CE:  0.2369 | S_OoD:  0.6233 | S_z:  0.0010 | G: -0.0012 | S_z:  0.0012 | dist: 0.0719
Step: 710  | D:  0.2525 | CE:  0.3149 | S_OoD:  0.6350 | S_z:  0.0011 | G: -0.0012 | S_z:  0.0012 | dist: 0.0556
Step: 730  | D:  0.1589 | CE:  0.2224 | S_OoD:  0.6480 | S_z:  0.0012 | G: -0.0015 | S_z:  0.0015 | dist: 0.0710
Computing evaluation statistics...
> Evaluating InD Wasserstein distances...
> Evaluating OoD Wasserstein distances...

Overall Statistics
TPR@95TNR: 0.764
mean: 0.764 | std: 0.0 | MAD: 0.0
TPR@95TNR-Threshold: 0.47118031382560727
mean: 0.47118 | std: 0.0 | MAD: 0.0
TPR@99TNR: 0.5625
mean: 0.5625 | std: 0.0 | MAD: 0.0
TPR@99TNR-Threshold
: 0.5830873560905458
mean: 0.58309 | std: 0.0 | MAD: 0.0
AUROC: 0.9594188750000001

Validation Accuracy: 0.901
Validation Classification Loss: 0.2728063133955002
