
[KeOps] Warning : There were warnings or errors compiling formula :
<stdin>:1:10: fatal error: cuda.h: No such file or directory
compilation terminated.

[KeOps] Warning : 
    The location of Cuda header files cuda.h and nvrtc.h could not be detected on your system.
    You must determine their location and then define the environment variable CUDA_PATH,
    either before launching Python or using os.environ before importing keops. For example
    if these files are in /vol/cuda/10.2.89-cudnn7.6.4.38/include you can do :
      import os
      os.environ['CUDA_PATH'] = '/vol/cuda/10.2.89-cudnn7.6.4.38'
    
[KeOps] Compiling cuda jit compiler engine ... 
[KeOps] Warning : There were warnings or errors compiling formula :
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/nvrtc_jit.cpp:5:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
[pyKeOps] Compiling nvrtc binder for python ... 
[KeOps] Warning : There were warnings or errors compiling formula :
In file included from /home/xysong/.local/lib/python3.9/site-packages/pykeops/common/keops_io/pykeops_nvrtc.cpp:4:
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/keops_nvrtc.cpp:6:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
[pyKeOps] Compiling nvrtc binder for python ... 
[KeOps] Warning : There were warnings or errors compiling formula :
In file included from /home/xysong/.local/lib/python3.9/site-packages/pykeops/common/keops_io/pykeops_nvrtc.cpp:4:
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/keops_nvrtc.cpp:6:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
[pyKeOps] Compiling nvrtc binder for python ... 
[KeOps] Warning : There were warnings or errors compiling formula :
In file included from /home/xysong/.local/lib/python3.9/site-packages/pykeops/common/keops_io/pykeops_nvrtc.cpp:4:
/home/xysong/.local/lib/python3.9/site-packages/keopscore/binders/nvrtc/keops_nvrtc.cpp:6:10: fatal error: nvrtc.h: No such file or directory
 #include <nvrtc.h>
          ^~~~~~~~~
compilation terminated.

OK
Experiment: FashionMNIST
Experiment regime: Balanced
Method: OOD-GAN
================================================================================
Number of observed OoD samples (class-level): 64
Input Dimension: 28 x 28 x 1
Number of InD classes: 8
Number of Epochs: 16.
Hyperparameters: lambda_ce=1 & lambda_w=0.1 & scaling=0.09999999999999999 & d_lr=0.001 & g_lr=0.001 & B_InD: 64 & B_OoD: 32 & n_d: 1 & n_g: 1
Score Function: Wasserstein
Finished Processing Input Arguments.
-- Current Device: Tesla V100-PCIE-16GB
-- Device Total Memory: 15.77 GB
-- Let's use 1 GPUs!
Verifying OOD set labels: tensor([8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
        8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
        8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9,
        9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
        9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
        9, 9, 9, 9, 9, 9, 9, 9])
Verifying OOD class distribution: Counter({8: 64, 9: 64})
Monte Carlo Iteration 0
DenseNet
Deep_G
OoD sample shape: torch.Size([128, 1, 28, 28])
Step: 0    | D:  2.0317 | CE:  2.1043 | S_OoD:  0.8057 | S_z:  0.8016 | G: -0.0082 | S_z:  0.8234 | dist: 0.0906
Step: 20   | D:  1.1027 | CE:  1.1677 | S_OoD:  0.7315 | S_z:  0.8209 | G: -0.0082 | S_z:  0.8235 | dist: 0.0843
Step: 40   | D:  0.8817 | CE:  0.9387 | S_OoD:  0.6475 | S_z:  0.7725 | G: -0.0078 | S_z:  0.7846 | dist: 0.0994
Step: 60   | D:  0.5719 | CE:  0.6332 | S_OoD:  0.6901 | S_z:  0.7694 | G: -0.0077 | S_z:  0.7660 | dist: 0.1018
Step: 80   | D:  0.5764 | CE:  0.6355 | S_OoD:  0.6646 | S_z:  0.7334 | G: -0.0074 | S_z:  0.7353 | dist: 0.0592
Step: 100  | D:  0.6925 | CE:  0.7522 | S_OoD:  0.6689 | S_z:  0.7154 | G: -0.0072 | S_z:  0.7165 | dist: 0.0763
Step: 120  | D:  0.7485 | CE:  0.8063 | S_OoD:  0.6473 | S_z:  0.6908 | G: -0.0068 | S_z:  0.6819 | dist: 0.0771
Step: 140  | D:  0.5059 | CE:  0.5655 | S_OoD:  0.6633 | S_z:  0.6794 | G: -0.0068 | S_z:  0.6753 | dist: 0.0891
Step: 160  | D:  0.3831 | CE:  0.4423 | S_OoD:  0.6585 | S_z:  0.6597 | G: -0.0066 | S_z:  0.6602 | dist: 0.0852
Step: 180  | D:  0.3613 | CE:  0.4183 | S_OoD:  0.6386 | S_z:  0.6790 | G: -0.0067 | S_z:  0.6736 | dist: 0.0997
Step: 200  | D:  0.3148 | CE:  0.3720 | S_OoD:  0.6404 | S_z:  0.6767 | G: -0.0068 | S_z:  0.6784 | dist: 0.1130
Step: 220  | D:  0.3034 | CE:  0.3646 | S_OoD:  0.6761 | S_z:  0.6435 | G: -0.0065 | S_z:  0.6525 | dist: 0.1073
Step: 240  | D:  0.5433 | CE:  0.6028 | S_OoD:  0.6621 | S_z:  0.6686 | G: -0.0066 | S_z:  0.6609 | dist: 0.0949
Step: 260  | D:  0.3775 | CE:  0.4370 | S_OoD:  0.6586 | S_z:  0.6374 | G: -0.0063 | S_z:  0.6348 | dist: 0.0827
Step: 280  | D:  0.4864 | CE:  0.5481 | S_OoD:  0.6794 | S_z:  0.6262 | G: -0.0064 | S_z:  0.6367 | dist: 0.0736
Step: 300  | D:  0.3985 | CE:  0.4563 | S_OoD:  0.6423 | S_z:  0.6361 | G: -0.0063 | S_z:  0.6312 | dist: 0.0953
Step: 320  | D:  0.3903 | CE:  0.4463 | S_OoD:  0.6225 | S_z:  0.6198 | G: -0.0062 | S_z:  0.6230 | dist: 0.0870
Step: 340  | D:  0.4136 | CE:  0.4769 | S_OoD:  0.6928 | S_z:  0.6043 | G: -0.0059 | S_z:  0.5927 | dist: 0.0945
Step: 360  | D:  0.2478 | CE:  0.3095 | S_OoD:  0.6788 | S_z:  0.6179 | G: -0.0062 | S_z:  0.6171 | dist: 0.0723
Step: 380  | D:  0.4133 | CE:  0.4774 | S_OoD:  0.6974 | S_z:  0.5624 | G: -0.0056 | S_z:  0.5610 | dist: 0.1227
Step: 400  | D:  0.3970 | CE:  0.4631 | S_OoD:  0.7214 | S_z:  0.6070 | G: -0.0061 | S_z:  0.6056 | dist: 0.0969
Step: 420  | D:  0.2988 | CE:  0.3593 | S_OoD:  0.6627 | S_z:  0.5786 | G: -0.0058 | S_z:  0.5774 | dist: 0.0895
Step: 440  | D:  0.4442 | CE:  0.5061 | S_OoD:  0.6799 | S_z:  0.6044 | G: -0.0060 | S_z:  0.6012 | dist: 0.0694
Step: 460  | D:  0.3557 | CE:  0.4187 | S_OoD:  0.6908 | S_z:  0.6016 | G: -0.0060 | S_z:  0.6019 | dist: 0.0863
Step: 480  | D:  0.2249 | CE:  0.2904 | S_OoD:  0.7154 | S_z:  0.5962 | G: -0.0059 | S_z:  0.5903 | dist: 0.0969
Step: 500  | D:  0.3646 | CE:  0.4276 | S_OoD:  0.6839 | S_z:  0.5393 | G: -0.0054 | S_z:  0.5433 | dist: 0.0722
Step: 520  | D:  0.2785 | CE:  0.3438 | S_OoD:  0.7110 | S_z:  0.5781 | G: -0.0058 | S_z:  0.5751 | dist: 0.0931
Step: 540  | D:  0.2994 | CE:  0.3646 | S_OoD:  0.7092 | S_z:  0.5689 | G: -0.0057 | S_z:  0.5664 | dist: 0.0850
Step: 560  | D:  0.3361 | CE:  0.3985 | S_OoD:  0.6800 | S_z:  0.5636 | G: -0.0055 | S_z:  0.5500 | dist: 0.0886
Step: 580  | D:  0.2350 | CE:  0.3003 | S_OoD:  0.7074 | S_z:  0.5487 | G: -0.0055 | S_z:  0.5513 | dist: 0.0975
Step: 600  | D:  0.2305 | CE:  0.2947 | S_OoD:  0.7003 | S_z:  0.5882 | G: -0.0059 | S_z:  0.5935 | dist: 0.0673
Step: 620  | D:  0.3029 | CE:  0.3683 | S_OoD:  0.7108 | S_z:  0.5720 | G: -0.0058 | S_z:  0.5772 | dist: 0.0936
Step: 640  | D:  0.3564 | CE:  0.4188 | S_OoD:  0.6789 | S_z:  0.5452 | G: -0.0053 | S_z:  0.5266 | dist: 0.1096
Step: 660  | D:  0.1635 | CE:  0.2302 | S_OoD:  0.7196 | S_z:  0.5221 | G: -0.0052 | S_z:  0.5181 | dist: 0.0686
Step: 680  | D:  0.3388 | CE:  0.4064 | S_OoD:  0.7306 | S_z:  0.5461 | G: -0.0054 | S_z:  0.5357 | dist: 0.0823
Step: 700  | D:  0.6166 | CE:  0.6834 | S_OoD:  0.7216 | S_z:  0.5397 | G: -0.0054 | S_z:  0.5364 | dist: 0.0772
Step: 720  | D:  0.1989 | CE:  0.2650 | S_OoD:  0.7171 | S_z:  0.5669 | G: -0.0056 | S_z:  0.5577 | dist: 0.0827
Step: 740  | D:  0.3055 | CE:  0.3726 | S_OoD:  0.7213 | S_z:  0.5079 | G: -0.0050 | S_z:  0.5029 | dist: 0.0949
Computing evaluation statistics...
> Evaluating InD Wasserstein distances...
> Evaluating OoD Wasserstein distances...

Overall Statistics
TPR@95TNR: 0.905
mean: 0.905 | std: 0.0 | MAD: 0.0
TPR@95TNR-Threshold: 0.4920752823352812
mean: 0.49208 | std: 0.0 | MAD: 0.0
TPR@99TNR: 0.756
mean: 0.756 | std: 0.0 | MAD: 0.0
TPR@99TNR-Threshold
: 0.6050024062395104
mean: 0.605 | std: 0.0 | MAD: 0.0
AUROC: 0.98149125

Validation Accuracy: 0.881375
Validation Classification Loss: 0.3286681352853775
Step: 10   | D:  0.1512 | CE:  0.2199 | S_OoD:  0.7402 | S_z:  0.5315 | G: -0.0052 | S_z:  0.5153 | dist: 0.1035
Step: 30   | D:  0.1272 | CE:  0.1915 | S_OoD:  0.6953 | S_z:  0.5159 | G: -0.0051 | S_z:  0.5063 | dist: 0.1042
Step: 50   | D:  0.1723 | CE:  0.2370 | S_OoD:  0.6997 | S_z:  0.5350 | G: -0.0053 | S_z:  0.5328 | dist: 0.0839
Step: 70   | D:  0.1846 | CE:  0.2525 | S_OoD:  0.7349 | S_z:  0.5518 | G: -0.0055 | S_z:  0.5464 | dist: 0.0859
Step: 90   | D:  0.2257 | CE:  0.2919 | S_OoD:  0.7123 | S_z:  0.5044 | G: -0.0051 | S_z:  0.5069 | dist: 0.1002
Step: 110  | D:  0.2192 | CE:  0.2863 | S_OoD:  0.7214 | S_z:  0.4975 | G: -0.0049 | S_z:  0.4935 | dist: 0.0725
Step: 130  | D:  0.2535 | CE:  0.3231 | S_OoD:  0.7545 | S_z:  0.5879 | G: -0.0058 | S_z:  0.5791 | dist: 0.1029
Step: 150  | D:  0.2316 | CE:  0.2984 | S_OoD:  0.7163 | S_z:  0.4761 | G: -0.0046 | S_z:  0.4584 | dist: 0.0965
Step: 170  | D:  0.3169 | CE:  0.3861 | S_OoD:  0.7387 | S_z:  0.4658 | G: -0.0045 | S_z:  0.4522 | dist: 0.1104
Step: 190  | D:  0.1517 | CE:  0.2219 | S_OoD:  0.7550 | S_z:  0.5283 | G: -0.0053 | S_z:  0.5269 | dist: 0.1066
Step: 210  | D:  0.2228 | CE:  0.2912 | S_OoD:  0.7360 | S_z:  0.5243 | G: -0.0051 | S_z:  0.5132 | dist: 0.0739
Step: 230  | D:  0.2757 | CE:  0.3427 | S_OoD:  0.7220 | S_z:  0.5203 | G: -0.0051 | S_z:  0.5141 | dist: 0.1004
Step: 250  | D:  0.0976 | CE:  0.1669 | S_OoD:  0.7459 | S_z:  0.5217 | G: -0.0052 | S_z:  0.5156 | dist: 0.1035
Step: 270  | D:  0.1255 | CE:  0.1950 | S_OoD:  0.7468 | S_z:  0.5208 | G: -0.0052 | S_z:  0.5184 | dist: 0.0853
Step: 290  | D:  0.3828 | CE:  0.4504 | S_OoD:  0.7255 | S_z:  0.4988 | G: -0.0050 | S_z:  0.4976 | dist: 0.0967
Step: 310  | D:  0.2124 | CE:  0.2817 | S_OoD:  0.7429 | S_z:  0.5021 | G: -0.0049 | S_z:  0.4914 | dist: 0.0908
Step: 330  | D:  0.1579 | CE:  0.2276 | S_OoD:  0.7450 | S_z:  0.4730 | G: -0.0047 | S_z:  0.4655 | dist: 0.0500
Step: 350  | D:  0.2242 | CE:  0.2928 | S_OoD:  0.7299 | S_z:  0.4459 | G: -0.0043 | S_z:  0.4348 | dist: 0.0971
Step: 370  | D:  0.2440 | CE:  0.3127 | S_OoD:  0.7359 | S_z:  0.4866 | G: -0.0047 | S_z:  0.4714 | dist: 0.0810
Step: 390  | D:  0.1718 | CE:  0.2420 | S_OoD:  0.7509 | S_z:  0.4892 | G: -0.0048 | S_z:  0.4831 | dist: 0.0898
Step: 410  | D:  0.2692 | CE:  0.3392 | S_OoD:  0.7465 | S_z:  0.4700 | G: -0.0046 | S_z:  0.4558 | dist: 0.0903
Step: 430  | D:  0.1594 | CE:  0.2309 | S_OoD:  0.7587 | S_z:  0.4331 | G: -0.0043 | S_z:  0.4287 | dist: 0.0713
Step: 450  | D:  0.2785 | CE:  0.3502 | S_OoD:  0.7610 | S_z:  0.4452 | G: -0.0044 | S_z:  0.4409 | dist: 0.0844
Step: 470  | D:  0.0845 | CE:  0.1549 | S_OoD:  0.7505 | S_z:  0.4714 | G: -0.0047 | S_z:  0.4688 | dist: 0.0795
Step: 490  | D:  0.3447 | CE:  0.4130 | S_OoD:  0.7310 | S_z:  0.4763 | G: -0.0047 | S_z:  0.4657 | dist: 0.0648
Step: 510  | D:  0.3284 | CE:  0.3974 | S_OoD:  0.7366 | S_z:  0.4594 | G: -0.0045 | S_z:  0.4545 | dist: 0.0870
Step: 530  | D:  0.1908 | CE:  0.2599 | S_OoD:  0.7372 | S_z:  0.4664 | G: -0.0046 | S_z:  0.4570 | dist: 0.0886
Step: 550  | D:  0.1342 | CE:  0.2077 | S_OoD:  0.7820 | S_z:  0.4740 | G: -0.0049 | S_z:  0.4859 | dist: 0.1026
Step: 570  | D:  0.0926 | CE:  0.1646 | S_OoD:  0.7670 | S_z:  0.4770 | G: -0.0046 | S_z:  0.4650 | dist: 0.1117
Step: 590  | D:  0.1861 | CE:  0.2608 | S_OoD:  0.7924 | S_z:  0.4582 | G: -0.0045 | S_z:  0.4479 | dist: 0.0614
Step: 610  | D:  0.0465 | CE:  0.1206 | S_OoD:  0.7845 | S_z:  0.4401 | G: -0.0043 | S_z:  0.4343 | dist: 0.0772
Step: 630  | D:  0.1909 | CE:  0.2638 | S_OoD:  0.7758 | S_z:  0.4723 | G: -0.0047 | S_z:  0.4700 | dist: 0.0990
Step: 650  | D:  0.0810 | CE:  0.1512 | S_OoD:  0.7512 | S_z:  0.4865 | G: -0.0049 | S_z:  0.4868 | dist: 0.0624
Step: 670  | D:  0.3102 | CE:  0.3819 | S_OoD:  0.7623 | S_z:  0.4572 | G: -0.0046 | S_z:  0.4569 | dist: 0.0771
Step: 690  | D:  0.1265 | CE:  0.1981 | S_OoD:  0.7679 | S_z:  0.5139 | G: -0.0050 | S_z:  0.4954 | dist: 0.0719
Step: 710  | D:  0.2193 | CE:  0.2926 | S_OoD:  0.7788 | S_z:  0.4536 | G: -0.0045 | S_z:  0.4521 | dist: 0.0556
Step: 730  | D:  0.1542 | CE:  0.2256 | S_OoD:  0.7573 | S_z:  0.4396 | G: -0.0042 | S_z:  0.4170 | dist: 0.0710
Computing evaluation statistics...
> Evaluating InD Wasserstein distances...
> Evaluating OoD Wasserstein distances...

Overall Statistics
TPR@95TNR: 0.9385
mean: 0.9385 | std: 0.0 | MAD: 0.0
TPR@95TNR-Threshold: 0.46747054457664483
mean: 0.46747 | std: 0.0 | MAD: 0.0
TPR@99TNR: 0.871
mean: 0.871 | std: 0.0 | MAD: 0.0
TPR@99TNR-Threshold
: 0.5875343376398088
mean: 0.58753 | std: 0.0 | MAD: 0.0
AUROC: 0.98825428125

Validation Accuracy: 0.903625
Validation Classification Loss: 0.2714245929121971
